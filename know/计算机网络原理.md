# 计算机网络概述

## 基本概念

### 一、计算机网络的定义

定义：互连的、自治的计算机的集合

### 二、协议的定义

定义：通过通信实体之间在数据交换过程中需要的规则或约定

1. 语法

   实体之间交换信息的格式与结构

2. 语义

   发送信息的具体含义

3. 时序

   实体之间交换信息的顺序以及如何匹配或适应彼此的速度

### 三、计算机网络的功能

1. 硬件资源共享
2. 软件资源共享
3. 信息资源共享

### 四、计算机网络分类

1. 覆盖范围：个域网、局域网、城域网、广域网

2. 拓扑结构：

   **星形**：易于管理，但是线多，成本高且中心节点崩坏则全局崩塌

   **总线型**：结构简单成本低，但是网络性能和效率低，故障不好排查

   **环形**：结构简单，故障不好排除，新节点或旧节点的加入和退出会复杂

   **网状**：两个节点通讯可以选择多种路线，但是复杂，成本高

   **树形**：易于管理，但是线多，成本高且中心节点崩坏则全局崩塌

   **混合拓扑结构**：复杂，难以管理

3. 交换方式：电路交换网络、报文交换网络和分组交换网络

4. 网络用户属性：公用网、私有网 

---

## 计算机网络结构

### 一、网络边缘

提供服务

### 二、接入网络

1. 电话拨号
2. 非对称用户数字线ADSL
3. 混合光纤同轴电缆HFC
4. 局域网
5. 移动接入网络

### 三、网络核心

实现数据转发，数据通信

---

## 数据交换

### 一、数据交换概念

交换节点和传输介质的集合成为通信子网，即网络核心

### 二、电路交换

中间交换节点为两台主机建立专用通信线路，称为**电路**，通信结束后拆除电路

优点：实时性高

缺点：对于突发性的传输时，信道利用率低

### 三、报文交换

**以报文为单位**在各个节点**存储-转发**的方式传输

特点：1.不用建立连接；2.只有报文在转发时才会占用信道；3.交换节点需要缓冲存储，时间会长

### 四、分组交换

将完整的报文拆分成若干个**分组**，分组传输

优点：

1. 交换设备存储量低
2. 交换速度快
3. 可靠传输效率高
4. 更加公平

分组长度的确定

1. 分组长度与延迟时间
2. 分组长度与误码率

---

## 计3算机网络性能

### 一、速率与带宽

1. **速率**指网络单位时间内传送的数据量，称传输速率或数据速率。速率的基本单位是bit/s。
2. **带宽**也描述速率
3. 带宽原本是指信号具有的**频带宽度**，即信号成分的最高频率与最低频率之差，单位是Hz（赫兹）

### 二、时延

1. 数据传输需要的时间

2. 分组的4类主要问题：

   3结点处时延、排队时延、传输时延、传播时延

### 三、时延带宽积

一段物理链路的传播时延与链路带宽的乘积，表示一段链路上可以容纳的数据量

### 四、丢包率

用于评价和衡量网络**性能**的指标，反应网络的**拥塞**程度

**丢包率**=丢失分组总数/发送分组数

### 五、吞吐量

源主机向目的主机**实际送达的数据量**

**度量**网络的实际传输能力

---

## 计算机网络分层体系结构

### 一、计算机网络分层体系结构

1. 分层思想：

   功能分层

2. 体系结构定义：

   划分的层次以及各层协议的集合

### 二、OSI参考模型

| OSI发送进程 |                | 接受进程   |
| ----------- | -------------- | ---------- |
| 应用层      | 数据           | 应用层     |
| 表示层      | 数据           | 表示层     |
| 会话层      | 数据           | 会话层     |
| 传输层      | 分段           | 传输层     |
| 网络层      | 分组（数据报） | 网络层     |
| 数据链路层  | 帧             | 数据链路层 |
| 物理层      | 比特           | 物理层     |

### 三、TCP/IP参考模型

应用层				HTTP		SMTP		DNS		RTP		（实现端到端）

运输层						TCP							UDP			（实现复用分用和可靠传输）

网络层											IP								（网络路径选择的功能）

数据链路层		网络接口1	网络接口2	网络接口3	（点到点传输的功能）

### 四、五层参考协议

应用层		报文

传输层		段

网络层		数据报

链路层		帧

物理层		比特流

---

# 网络应用

## 计算机网络应用体系结构

三种类型：

1. 客户/服务器结构 

   只能进行客户和服务器通信

2. P2P结构

   对等端可以直接通信 可以实现服务器和客户端互相转换身份

3. 混合型

---

## 域名系统（DNS）

**UDP协议的53号端口**

1. 域名解析

   将域名映射成IP地址

2. 域名服务器

   建立分布式数据库，提供域名解析

3. 域名服务器分类

   根域名服务器

   顶级域名服务器

   权威域名服务器

   本地域名服务器

### 域名解析过程

1. 递归查询

   从低级到高级的服务器发送请求

2. 迭代查询

   本服务器解析不了就像其他服务器发送

---

## 万维网应用结构

### 超文本传输器（HTTP）在TCP协议上

**超文本传输协议** 浏览器向服务器发送请求 服务器向浏览器响应 

**HTTP连接**：非持久连接 持久连接

**HTTP报文**：

请求报文——从客户向服务器发送请求报文

响应报文——服务器到客户端的回应

### HTTP响应报文：

| 状态码 | 作用       | 描述                             |
| ------ | ---------- | -------------------------------- |
| 1xx    | 信息提示   | 通告信息，还需要进一步交互       |
| 2xx    | 成功       | 请求成功，正常响应               |
| 3xx    | 重定向     | 表示资源飘走，需要向新的URL请求  |
| 4xx    | 客户端错误 | 由于客户端请求错误，无法成功响应 |
| 5xx    | 服务器错误 | 由于服务器错误，无法成功响应     |



### Cookie

小型文本文件，进行回话跟踪

---

## 电子传输协议（SMTP）

SMTP是电子邮件中核心**应用层协议**

使用传输层**TCP**实现可靠数据传输，**端口号25**

SMTP的三个阶段：**握手阶段、邮件传输阶段、关闭阶段**

---

## 文件传送协议（ftp）

互联网两个主机间实现文件互传的应用层协议

控制连接：21端口 传输控制命令

数据连接：20端口 传输文件内容

---

## P2P应用

优势：充分聚集利用了端系统的计算能力和网络传输宽带，对服务器依赖小

---

# 传输层

## 传输层的基本服务

传输层的核心任务是 **应用进程**之间提供**端到端的逻辑通信服务**

## 传输层寻址与端口

用**端口号**对应用程序进行表示

在全网范围利用“**IP地址+端口号**”唯一标识一个通信端口

**传输层端口**号为16位整数，包含三类端口：

1. 熟知端口号：0~1023
2. 登记端口号：1024~49151 必须在IANA登记，防止重复
3. 客户端口号或短暂端口号：数值为49152~65535，留给客户进程选择暂时使用。

### 无连接服务与面向连接服务

无连接服务——UDP

面向连接服务——TCP（建立逻辑连接，再传输数据，传输完成拆除连接）

### 传输层的复用和分解

**多路复用**和**多路分解**

### 无连接的多路复用和多路分解

UDP套接字：<目的IP地址，目的端口号>

### 面向连接的多路复用与多路分解

TCP套接字（标识一条TCP连接）：<源IP地址，源端口号，目的IP地址，目的端口号>

---

## 停等协议

**发送报文后就停，等待接收方确认**

### 基本工作过程：

发送并等待确认

接受并确认/否认

继续发送/重发

### 停等协议的主要性能问题：

**停止-等待机制降低了信道利用率**

解决方法：

**流水线协议或管道协议——允许发送在没有收到确认前连续发送多个分组**

流水线协议改进：

**增加分组序号范围；发送方和接收方必须缓存多个分组**

典型流水线协议：**滑动窗口协议**

## 滑动窗口协议

1. 回退N步（GBN）协议

   接收端口仅为1，只能接受一个**按序到达**的分组；哪个分组错了，之后都要重发

2. 选择重传（SR）协议

   增加接收方缓存能力（接收窗口>1），等待缺失窗口

---

## 用户数据报协议（UDP）

传输层协议，提供**无连接、不可靠**、数据报尽力传输服务

### UDP数据报结构

1. 源和目的端口号：用于UDP实现复用与分解
2. 长度字段：在UDP报文段中的字节数（首部和数据的总和）
3. 校验和：接收方用来检测该报文是否出现差错

---

## 传输控制协议（TCP）

连接建立三次握手：

1. SYN连接请求（客户端向服务器）
2. SYNACK确认
3. ACK确认

断开建立四次挥手

### TCP流量控制

通过通告接收窗口大小控制流量

### TCP拥塞控制

通过调节窗口的大小实现对发送数据速率的调整

---

AIMD 加性增加，乘性减少

网络未拥堵，一个一个加窗口；网络一旦拥堵，一次减一半的窗口

---

拥塞控制算法：

慢启动、拥塞避免、快速重传、快速恢复

---

# 网络层

## 网络层服务

网络层是将网络层数据报从**源主机**送到**目的主机**

主要功能：

**转发**：分组从输入接口转移到输出接口

**路由选择**：决定分组经过的路由或路径

---

## 数据报网络和虚电路网络

### 数据报网络

按照**主机地址**进行路由选择的网络

特点：

**无连接**；

每个分组作为一个**独立**的数据进行传输，路径也可能不同；

分组可能出现**乱序**和**丢失**。

---

### 虚电路网络

在网络层提供面向**连接**的分组交换服务

特点：

需要建立一条网络层**逻辑连接**；

**不需要**为每条虚电路**分配独享资源**；

根据虚电路号沿虚电路路径**按序发送**分组。

---

## 网络互联与网络互联设备

### 异构网络互联

异构网络：两个网络的**通信技术**和运行的**协议**不同

基本策略：

1. 协议转换
2. 构建虚拟互联网络

### 路由器

交换结构：

1. 基于内存交换
2. 基于总线交换
3. 基于网络交换

---

## 网络层拥塞

### 拥塞：一种持续过载的网络状态，此时用户对网络资源（包括**链路带宽**、**存储空间**、**处理器处理能力**）的总量超过了网络固有的容量

原因：

1. 缓冲区容量有限；
2. 传输线路的带宽有限；
3. 网络节点的处理能力有限；
4. 网络中某些部分发生了故障；

### 流量感知路由

根据网络负载**动态调整**，将网络流量引导到不同链路上，**均衡网络负载**

解决震荡现象：

1. 多路径路由；
2. 缓慢转移流量至另一链路

### 准入控制

应用于**虚电路网络**预防拥塞技术

**审核**新建的虚电路，如果拥塞，**拒绝建立该新虚电路**

拥塞状况的量化：基于**平均流量**和**瞬时流量**

### 流量调节

**抑制分组**：给拥塞数据报**源主机**返回一个抑制分组

**背压**：让抑制分组在从拥塞节点到源节点的路径上的**每一跳**，都发挥抑制作用

### 负载脱落

路由器**主动丢弃**某些数据报

1. 丢弃新分组：如GBN
2. 丢弃老分组：如实时视频流

---

## Internet网络层

### IP数据报分片

标识：判断这些分片是否属于**同一个IP数据报**

标志：判断是否为**最后一个分片**

**片偏移**：判断各分片的**先后顺序**

---

### IP地址

分类地址：A、B、C、D、E

![image-20220111204817823](C:\Users\Jamin\AppData\Roaming\Typora\typora-user-images\image-20220111204817823.png)

---

**子网掩码**

划分网段方法 **延长子网掩码**

---

**分组转发**：查找转发表 **最长前缀匹配**（子网掩码数最多的匹配）

**路由聚合**：将相同路由的连续子网合并



| 128  | 1    |
| ---- | ---- |
| 64   | 1    |
| 32   | 1    |
| 16   | 1    |
| 8    | 1    |
| 4    | 1    |
| 2    | 1    |
| 1    | 1    |

---

### 动态主机配置协议（DHCP）

为网络提供动态IP分配服务

---

### 网络地址转换（NAT）

1. 从内网进入互联网的IP数据报：

   将其源IP地址替换为NAT服务器拥有的合法的共有IP地址

2. 从互联网返回的IP数据报：

   依据其目的IP地址与端口号检索NAT转换表，得到内部私有IP地址与端口号

---

### 互联网控制报文协议（ICMP）

在主机和路由器间，实现**差错信息报告**

---

### IPv6

首部长度**固定40字节**

IPv4到IPv6的迁移：**双协议栈；隧道**

---

## 路由算法与路由协议

链路状态路由选择算法是一种**全局式**路由选择算法

每个路由器通过从其他路由器获得的**链路状态信息**构建出整个**网络的拓扑图**

计算最短路径——**Dijkstra算法**

### Dijkstra算法

算出最短的路线 并记录其路线 传输选择**最短路径**

---

### 距离向量路由选择算法

每个节点基于其**与邻居节点间的直接链路距离**，以及**邻居交换过来的距离向量**，计算并更新其到达每个目的结点的最短距离，然后将新的距离向量通告给邻居，直到距离向量不在改变。***（通告最短的距离并计算）***

Bellman-Ford方程

---

### 层次化路由选择

实现大规模网络路由选择最有效、可行的解决方法

划分自治系统：

网关路由器

自治系统间路由协议

---

### 路由协议选择

**内部网关协议**

1. RIP：

   基于**距离向量路由**选择算法，跳数作为距离度量最大距离不超过15跳，没30秒交换一次距离向量

2. OSPF：

   基于**链路状态路由**选择算法

**外部网关协议**：BGP

---

# 数据链路层

## 数据链路层服务

**链路**：通信链路连接的**相邻结点**的通信信道

链路层数据单元：**帧**

1. **组帧**
2. **链路接入**、**点对点链路**、**广播链路**
3. **可靠交付**（可靠传输方法多用于**高出错率链路**）
4. **差错控制**

---

## 差错控制

1. 检错重发

2. 前向纠错

   接收端进行**差错纠正**

3. 反馈校验

   接收端将收到的数据原封不动发回发送端

4. 检错丢弃

### 差错编码的检错与纠错

汉明距离：两个等长码字之间，对应**不同的位数**

1. 检错编码：ds=r+1 检测r位的差错

   看编码中不一样位数，不一样位数**最少**的就是ds

2. 纠正编码：ds=2r+1 纠正r位的差错

   看编码中不一样位数，不一样位数**最少**的就是ds

   从而算出r,再看与哪个编码的ds类似 进行纠错

### 典型的编码错误

1. 奇偶校验码（在编码后加1，再看编码子中"1"的个数）：

   奇校验：编码后的码字中"1"的个数为奇数

   偶校验：编码后的码字中"1"的个数为偶数

2. 汉明码：可以实现单个比特差错纠  正

3. 循环冗余码CRC：

   检错**能力强**，编码效率高，实现简单

   如果是G（x）=x^4+x+1

   就取多项式的系数

   ```
   1*X^4 + 0*X^3 + 0*X^2 + 1*X^1 + 1*X^0
   可以得出
   10011
   ```

   **异或运算："同0异1"**

   生成的多项式有几位 就要在发送的数据后填-1个0

   例：生成多项式是10011 则要在发送的数据后添4个0

   **随后做类似除法的异或运算**

   ---

   ## 多路访问控制协议

   ### 信道划分MAC协议

   **广播信道**上用于协调各个节点的数据发送

   1. **频分多路复用**：将信道**带宽划分为多个子信道**
   2. **时分多路复用**：将信道的传输信号在时域内划分为多个等长的**时隙**
   3. **波分多路复用**：在一根光纤中，传播多路**不同波长**的光信号
   4. **码分多路复用**：从**编码域**进行划分，使得编码后的信号在同一信道中混合传输

### 随机访问MAC协议

1. ALOHA协议

   纯ALOHA：直接发送→信道侦听→冲突重发

   时隙ALOHA：时隙开始时发送→信道侦听→冲突则下一时隙以概率P重发

2. **载波监听**多路访问协议CSMA

   **发送前监听信道是否空闲**

   1. 非坚持CSMA：忙则等待随机时间后再侦听
   2. 1-坚持CSMA：忙则持续侦听
   3. P-坚持CSMA：闲则概率P在最近时隙发送

3. 带冲突检测的载波监听多路访问协议CSMA/CD

   监听空闲后发送，发送时**检测碰撞**，碰撞后等待重发

### 受控接入MAC协议

1. **集中式控制**

   由一个**主机负责调度**其他通信站接入信道，从而避免冲突

   主要方法：**轮询技术**，又分**轮叫轮询**和**传递轮询**

2. **分散式控制**

   典型方法：**令牌技术**，如**令牌环网**

---

